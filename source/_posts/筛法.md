---
title: 筛法
date: 2016-09-12 17:05:21
tags:
- 算法
- TODO
---

> 此文尚未写完

筛法是一类检验范围内所有素数的方法。

常见的筛法有埃拉托斯特尼筛法(the sieve of Eratosthenes)与欧拉筛法(the sieve of Euler)。

|              | 时间复杂度              | 空间复杂度  |
| ------------ | ------------------ | ------ |
| Eratosthenes | $O(n \log \log n)$ | $O(n)$ |
| Euler        | $O(n)$             | $O(n)$ |

{% asset_img Sieve_of_Eratosthenes_animation.gif "埃拉托斯特尼筛法 the sieve of Eratosthenes" %}

观察上图的埃氏筛法，明显有一些数被不同的素数筛过，因而直观上埃氏筛法并不是线性时间复杂度的。

而欧拉筛采用了一种更为精巧的策略，保证了每个数只被筛一次来保证线性时间复杂度。

<!--more-->

# 埃拉托斯特尼筛法
埃拉托斯特尼筛法的核心思想是：

$$n \text{是素数} \Leftrightarrow \forall d \in [2, \sqrt{n}], d \nmid n$$

若要求解$[2, N]$中所有的素数，只需要每次选取一个素数然后划去所有它的倍数即可。

```cpp
int SieveOfEratosthenes(int n, int *prime, bool *isPrime) {
    // Initialize
    int cnt = 0;
    isPrime[0] = isPrime[1] = false;
    for (int i = 2; i <= n; i++) {
        isPrime[i] = true;
    }
    // Sieve
    for (int i = 2; i <= n; i++) {
        if (isPrime[i]) {
            prime[cnt++] = i;
            for (int j = i * i; j <= n; j += i) {
                isPrime[j] = false;
            }
        }
    }
    return cnt;
}
```

# 欧拉筛法
欧拉筛法的核心思想是：

$$n \text{是合数} \Leftrightarrow n = \prod_{i = 1}^k {p_i^{a_i}}, (a_i \gt 0, k \gt 1)$$

不妨设$i < j \Leftrightarrow p_i < p_j$ (升序), $p_1$ 是合数 $n$ 的最小质因子。

那么合数$n$存在一种唯一分解方式：

$$
\begin{align}
n & = \frac{n}{p_1} p_1 \\
  & = (p_1^{a_1 - 1} \prod_{i = 2}^k {p_i^{a_i}}) p_1
\end{align}
$$

设 $m = p_1^{a_1 - 1} \prod_{i = 2}^k {p_i^{a_i}}, n = m p_1, n' = m p_j$

$$
\begin{align}
m p_j & = (p_1^{a_1 - 1} \prod_{i = 2}^k {p_i^{a_i}}) p_j \\
      & = (p_1^{a_1 - 1} \prod_{i = 2}^k {p_i^{a_i + [i = j]}})
\end{align}
$$

$n' = m p_j$ 的最小质因子取决于 $a_1, (a_1 > 0)$：

$$
p_1' = 
\begin{cases}
p_1 & a_1 > 1 \\
p_2 & a_1 = 1 \\
\end{cases}
$$

从任意一个偶合数$2a$开始，对于$[2, a]$范围内的素数迭代$n \to n'$，我们可以得到所有的素数。

**一个合数能被唯一地分解成其最小质因数与另外一个数的乘积**

> 这种唯一分解方式蕴含了欧拉筛法的做法。
e.g.
$$
\begin{align}
24 & = 12 \times 2 \\
12 & = 6 \times 2 \\
18 & = 9 \times 2 \\
27 & = 9 \times 3 \\
50 & = 25 \times 2 \\
125 & = 25 \times 5
\end{align}
$$

{% include_code 欧拉筛法 SieveOfEuler.cpp lang:cpp %}

# 拓展欧拉筛法

在拓展欧拉筛法之前我们先来做一项工作来分析欧拉筛法线性工作的原因：
{% include_code 添加钩子的欧拉筛法 SieveOfEulerPrintf.cpp lang:cpp %}

***

TODO